MinecraftServerControlScript
=============================

A powerful command-line control script for Linux-powered Minecraft servers.


Installation
-----------------------------
To get your server to run the script on startup, and cleanly down the server
on shutdown, the minecraft_server script must be copied to `/etc/init.d`,
have its execute permissions set, and the system must be instructed to use
the script on startup and shutdown.  For Bash programmable completion
support, the mscs_completion script must be copied to 
`/etc/bash_completion.d`.  For security reasons, the script uses a user
account named minecraft rather than root and the account must be created
before the script is used.

This can all be done automatically with the included Makefile in Debian and
Ubuntu like environments by running:

    sudo make install


It can also be accomplished manually with the following commands:

    sudo cp minecraft_server /etc/init.d/minecraft_server
    sudo cp mscs_completion /etc/bash_completion.d/mscs_completion
    sudo chmod 755 /etc/init.d/minecraft_server
    sudo update-rc.d minecraft_server defaults
    sudo adduser minecraft

The Minecraft server software will be automatically downloaded to the
following location on the first run:

    /home/minecraft/minecraft_server/


Requirements
-----------------------------
I've made an attempt to utilize only features that are normally installed in
most Linux and UNIX environments in this script, but there are a few
requirements that this script has that may not already be in place:

* Java 6/7 JRE - The Minecraft server software requires this.
* Perl 5       - Most, if not all, Unix and Linux like systems have this
                 preinstalled.
* Python       - Required by the Minecraft Overviewer mapping software.
* GNU Wget     - Allows the script to download software updates via the
                 internet.
* rdiff-backup - Allows the script to efficiently run backups.
* Socat        - Allows the script to communicate with the Minecraft server.
* Iptables     - Although not explicitly required, a good firewall should be
                 installed.

If you are running Debian or Ubuntu, you can make sure that these are
installed by running:

    sudo apt-get install default-jre perl wget rdiff-backup socat iptables


Mapping Software
-----------------------------
The script now uses the Minecraft Overviewer mapping software to generate
maps of your worlds.  You can download premade binaries for supported systems
(Debian/Ubuntu, CentOS/RHEL/Fedora), or build your own binary from source if
needed.

    http://overviewer.org/


Multiple Worlds
-----------------------------
The script can handle running multiple Minecraft world servers.  See the
description for the 'create' world option below.


Firewall / NAT
-----------------------------
If you have a firewall installed on your computer, or a router using NAT
installed in your network, you will need to route some ports to your server.
Instructions on how to accomplish this are beyond the scope of this post, but
here are some things you will need to know:

* The default port for the Minecraft server is: 25565.
* If you wish to run multiple world servers using this script, you will
  want to open a range of ports (for example 25565 - 25575).

See the iptables.rules file for a very basic set of rules that you can use
with the Iptables filewall.


Usage
-----------------------------
All commands below assume that you are running them as either the minecraft
user or as root (through sudo).

Note: If the script is run as the root user, all important server processes
will be started using the minecraft user for security purposes.

    su minecraft
    /etc/init.d/minecraft_server <option>

or

    sudo /etc/init.d/minecraft_server <option>


Options
    start <world>
      Start the Minecraft world server.  Starts all world servers by default.
    stop <world>
      Stop the Minecraft world server.  Stops all world servers by default.
    force-stop <world>
      Forcibly stop the Minecraft world server.  Forcibly stops all world
      servers by default.
    restart <world>
      Restart the Minecraft world server.  Restarts all world servers by
      default.
    force-restart <world>
      Forcibly restart the Minecraft world server.  Forcibly restarts all
      world servers by default.
    create <world> <port> <ip>
      Create a Minecraft world server.  The world name and port must be
      provided, the IP address is usually blank.
    delete <world>
      Delete a Minecraft world server.
    disable <world>
      Temporarily disable a world server.
    enable <world>
      Enable a disabled world server.
    status <world>
      Display the status of the Minecraft world server.  Displays the status
      of all world servers by default.
    send <world> <command>
      Send a command to a Minecraft world server.
    logrotate <world>
      Rotate the server.log file.  Rotate the server.log file for all worlds
      by default.
    backup <world>
      Backup the Minecraft world.  Backup all worlds by default.
    watch <world>
      Watch the log file for the Minecraft world server.
    map <world>
      Run the Minecraft Overviewer mapping software on the Minecraft world.
      Maps all worlds by default.
    update
      Update the client and server software packages.


To start all of the world servers, issue the command:

    /etc/init.d/minecraft_server start


To create a world named alpha, issue the command:

    /etc/init.d/minecraft_server create alpha 25565


To start just the world named alpha, issue the command:

    /etc/init.d/minecraft_server start alpha


To send a command to a world server, issue the command:

    /etc/init.d/minecraft_server send <world> <command>

ie.
    /etc/init.d/minecraft_server send alpha say Hello world!


Message of the Day (MOTD)
-----------------------------
To whisper the message of the day to users as they log into the world, add a
file called motd.txt to the /home/minecraft directory.

    editor /home/minecraft/motd.txt


Colors
-----------------------------
To add colors to your Help or MOTD files, insert the following color codes
into your text:
    §0 - black
    §1 - blue
    §2 - deep green
    §3 - aqua
    §4 - deep red
    §5 - purple
    §6 - gold
    §7 - gray
    §8 - dark gray
    §9 - light blue
    §a - green
    §b - teal
    §c - red
    §d - magenta
    §e - yellow
    §f - white

Example motd.txt:

    §fWelcome to Minecraft!
    §fToday's theme is §4red§f.
    §fLook out for those §2creepers§f!


CraftBukkit
-----------------------------
To use the CraftBukkit server distribution instead of the default Mojang
server, modify the following lines of code:

## Minecraft server options.

# Choose only one server distribution, leave the other commented out.

# Default Mojang server distribution.
SERVER_URL="http://www.minecraft.net/download/minecraft_server.jar"
SERVER_JAR="minecraft_server.jar"
SERVER_ARGS="nogui"

# CraftBukkit server distribution.
# SERVER_URL="http://dl.bukkit.org/latest-rb/craftbukkit.jar"
# SERVER_JAR="craftbukkit.jar"
# SERVER_ARGS=""


Bukkit plugins are world specific and are contained within the plugins
directory of the world. ie.

/home/minecraft/worlds/alpha/plugins


If you would prefer to use the same plugins directory for all of your worlds,
you can create symlinks for each world.  ie.

mkdir /home/minecraft/plugins
ln -s /home/minecraft/plugins /home/minecraft/worlds/alpha/plugins
ln -s /home/minecraft/plugins /home/minecraft/worlds/beta/plugins


Lib Notify
-----------------------------
On systems that support lib notify, you can modify the script to print a
message on your desktop of important server events.

First, you need to know the name of the display you want to route the
messages to.  This is usually ":0.0", but it may be something different on
your system.

    glxinfo | grep "name of display"


If your username is different than the user used for the Minecraft server,
replace $USER_NAME in LIBNOTIFY_USER_NAME=$USER_NAME with the correct
username.

Modify the following lines of code in the script:

# To use lib-notify to print a message on your desktop of important server
events, change the following to a 1.
USE_LIBNOTIFY=0

# The username and display that notifications will be routed to.
LIBNOTIFY_USER_NAME=$USER_NAME
LIBNOTIFY_DISPLAY=":0.0"


License
-----------------------------
See LICENSE

Issues
-----------------------------
I have only tested this code in a Debian/Ubuntu environment, but there is no
reason that it shouldn't work in any appropriately configured UNIX-like
environment, including Apple Mac OSX and the other BSD variants, with only
minor modifications.  If you experience errors running this script, please
post a copy of the error message and a note detailing the operating
environment where the error occurs to the support thread, and I'll try to
work out a solution with you.

Support thread:  http://www.minecraftforum.net/viewtopic.php?f=10&t=129833
Github Issues: https://github.com/sandain/MinecraftServerControlScript/issues
